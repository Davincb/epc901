# Introduction
The [ESPROS epc901](https://www.espros.com/photonics/epc901/) is a CCD line sensor with a resolution of 1024 monochrome pixels.

Compared to other image sensors the epc901 is very easy to drive, requiring only one voltage, I2C, a few digital I/Os and an ADC. It is also relatively inexpensive
at [$24 in single units from Digi-key](https://www.digikey.com/en/products/detail/espros-photonics-ag/EPC901-CSP32-033/10516882). On the downside, the sensor
comes in a BGA package, the evaluation kit is [very expensive at $1350](https://www.digikey.com/en/products/detail/espros-photonics-ag/EPC901-EVALUATION-KIT-V1/10516848),
and we haven't seen this sensor from any other distributors than Digi-key.

This repository contains design files to build hardware and software to interact with the sensor. 

Except for files imported from the STM32 SDK ([```./software/breakout/Drivers```](https://github.com/astuder/epc901/tree/main/software/breakout/Drivers)), and a few files
auto-generated by STM32CubeIDE, all files in this project are licensed under *TBD*.

# Hardware

All hardware in this project is designed with KiCad version 5.1.6.

## Shared

The folder [```./hardware/shared```](https://github.com/astuder/epc901/tree/main/hardware/shared) contains KiCad symbols, footprints and 3d models that were
created for this project.

## Breakout board

The folder [```./hardware/breakout```](https://github.com/astuder/epc901/tree/main/hardware/breakout) contains the KiCad project for the epc901 breakout board.

The images sensor comes in a 2x16, 0.5 mm pitch BGA package and looks very fragile. With careful handling and placement, we successfully assembled a few boards
using a stainless steel solder stencil and an unmodified toaster oven for reflow. Reflow on a hotplate probably works as well.

In addition to the image sensor and related passives, the breakout board also integrates an ADC. Footprint and firmware are compatible with [Texas Instruments ADCS7476]
(https://www.ti.com/product/ADCS7476) and [Analog Devices AD7476](https://www.analog.com/en/products/ad7476.html) which are 1 MSPS 12-bit ADCs with SPI-like interface.

## Adapter board

The folder [```./hardware/adapter-shield```](https://github.com/astuder/epc901/tree/main/hardware/adapter-shield) contains the KiCad project for an adapter to mount the 
epc901 breakout board on the NUCLEO evaluation board.

The layout of the adapter board follows the Arduino Shield standard. This means you could mount the adapter and sensor breakout board on any compatible MCU board. Though
you will have to write your own firmware.

# Software

## Firmware

The folder [```./software/breakout```](https://github.com/astuder/epc901/tree/main/software/breakout) contains the firmware to control the epc901 breakout board with an
STM32L4 using the [NUCLEO-L496ZG evaluation board](https://www.digikey.com/en/products/detail/stmicroelectronics/NUCLEO-L496ZG/6697037). This specific MCU and
evaluation board were chosen because we had one laying around.

The firmware is developed and built with the latest version of STM32CubeIDE (version 1.4.2 as of October 2020). To import the project into STM32CubeIDE, clone this
repository, open STM32CubeIDE and import the project with ```File > Open Project From File System..```, select the folder ```./software/breakout```. Follow the standard
procedure for building the firmware and programming the NUCLEO evaluation board.

## Python

The folder [```./software/python```](https://github.com/astuder/epc901/tree/main/software/python) contains Python library that wraps the serial interface exposed by the
firmware, and examples of Python scripts that use the library.

### epc901camera.py

Python library wrapping the serial interface exposed by the firmware into an API that's easy to use from Python.

### live.py

Python script that displays output of the image sensor in realtime.

### snap.py

Python script that captures one image.

### burst.py

Python script that captures a series of images in a burst.
